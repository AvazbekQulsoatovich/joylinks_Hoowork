{% extends 'base/base.html' %}

{% block title %}Baholash: {{ submission.student.username }} - HooWork{% endblock %}

{% block content %}
<header class="page-header">
    <div>
        <a href="{% url 'homework_detail' submission.homework.pk %}" class="text-muted"
            style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
            <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i> Vazifa tafsilotlari
        </a>
        <h1 class="page-title">Topshiriqni baholash</h1>
        <p class="page-subtitle">Talaba: {{ submission.student.get_full_name|default:submission.student.username }}</p>
    </div>
</header>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
    <!-- Topshiriq mazmuni -->
    <div>
        <div class="card mb-3">
            <h3 class="card-title mb-3">Talaba javobi</h3>

            {% if submission.is_code %}
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-lang">{{ submission.code_language }}</span>
                    <button class="code-block-copy">
                        <i data-lucide="copy" style="width: 14px; height: 14px;"></i> Nusxalash
                    </button>
                </div>
                <pre><code>{{ submission.content }}</code></pre>
            </div>
            {% else %}
            <div
                style="background: var(--gray-50); padding: 1.5rem; border-radius: var(--radius); white-space: pre-wrap; line-height: 1.8;">
                {{ submission.content }}
            </div>
            {% endif %}

            {% if submission.file %}
            <div class="mt-3">
                <a href="{{ submission.file.url }}" class="btn btn-outline" target="_blank">
                    <i data-lucide="download" style="width: 18px; height: 18px;"></i>
                    Biriktirilgan faylni yuklab olish
                </a>
            </div>
            {% endif %}
        </div>

        <div class="card">
            <h3 class="card-title mb-3">Vazifa: {{ submission.homework.title }}</h3>
            <p class="text-muted" style="font-size: 0.875rem;">{{ submission.homework.description|truncatewords:50 }}
            </p>
        </div>
    </div>

    <!-- Baholash formasi -->
    <div>
        <div class="card" style="position: sticky; top: 2rem;">
            <h3 class="card-title mb-4">Baholash</h3>
            <form method="post">
                {% csrf_token %}

                <div class="form-group text-center">
                    <label class="form-label" style="text-align: left;">Baho (0-100 %)</label>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 1rem;">
                        {{ form.score_percent }}
                        <span style="font-size: 1.5rem; font-weight: 700; color: var(--gray-400);">%</span>
                    </div>
                    {% if form.score_percent.errors %}<small class="text-danger">{{form.score_percent.errors.0}}</small>{% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label">Izoh (ixtiyoriy)</label>
                    {{ form.teacher_comment }}
                    <small class="text-muted">Izoh talaba uchun ko'rinadi</small>
                </div>

                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                    <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                    Bahoni saqlash
                </button>
                <a href="{% url 'homework_detail' submission.homework.pk %}" class="btn btn-secondary mt-2"
                    style="width: 100%;">Bekor qilish</a>
            </form>

            <div class="mt-4 pt-4" style="border-top: 1px solid var(--gray-200);">
                <div class="text-muted mb-2" style="font-size: 0.875rem;">Topshirilgan vaqt:</div>
                <div class="font-bold">{{ submission.submitted_at|date:"d.m.Y H:i" }}</div>
                {% if submission.is_late %}
                <span class="badge badge-danger mt-1">KECHIKIB TOPSHIRILGAN</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}